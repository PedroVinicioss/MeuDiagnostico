trigger:
  branches:
    include:
      - master

pr:
  branches:
    include:
      - master

pool:
  vmImage: 'ubuntu-latest'

variables:
  - group: github

stages:
  - stage: SyncToGitHub
    displayName: 'Sync Azure master to GitHub portfolio'
    jobs:
      - job: PushToGitHub
        steps:
          - checkout: self
            clean: true
            persistCredentials: true
            fetchDepth: 0  # necess√°rio para ter acesso aos refs completos

          - script: |
              echo "üîß Configurando Git"
              git config --global user.name "Pedro Vin√≠cios"
              git config --global user.email "pedrooviniciossantos@gmail.com"

              echo "üîç Criando branch local 'master' a partir de origin/master"
              git checkout -b master origin/master

              echo "üìå Verificando refs locais"
              git show-ref

              echo "‚ûï Adicionando remoto GitHub"
              git remote add github https://${GITHUB_USERNAME}:${GITHUB_TOKEN}@github.com/PedroVinicioss/MeuDiagnostico.git

              echo "‚¨ÜÔ∏è Dando push da branch master para main no GitHub"
              git push github refs/heads/master:refs/heads/main --force
            env:
              GITHUB_USERNAME: $(github.username)
              GITHUB_TOKEN: $(github.token)
